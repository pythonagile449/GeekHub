{% extends 'base.html' %}
{% load static %}
{% load martortags %}
{% load ratings %}
{% load comments %}

{% block title %}
    {{ title }} :: {{ block.super }}
{% endblock %}

{% block css %}
    <link href="{% static 'plugins/css/ace.min.css' %}" type="text/css" media="all" rel="stylesheet"/>
    <link href="{% static 'martor/css/martor.bootstrap.min.css' %}" type="text/css" media="all" rel="stylesheet"/>
{% endblock %}

{% block content %}
    <div class="content-container">
        <div class="section-left">
            <div class="section-indent"></div>
            <div class="author-data">
                <ul class="author-data">
                    <li><img src="{% static 'svg/icon2.svg' %}" alt="icon"></li>
                    <li>
                        <h6-1>{{ article.author.username }}</h6-1>
                    </li>
                    <li>
                        <h6-2>{{ article.publication_date }}</h6-2>
                    </li>
                </ul>
            </div>

            <div class="section-left-title">
                <h2>
                    <h2-2>{{ article.title }}</h2-2>
                </h2>
            </div>

            <div class="chapter">
                <h6-3>{{ article.hub.name }}</h6-3>
            </div>

            <div class="section-left-text">
                {% if article.editor == 'CK' %}
                    <div class="ck-preview">
                        {{ article.contents_ck|safe }}
                    </div>
                {% elif article.editor == 'MD' %}
                    <div class="martor-preview">
                        {{ article.contents_md|safe_markdown }}
                    </div>
                {% endif %}


                {% if not article.is_draft %}
                    <div class="like-comment">
                        <ul class="lvc-field">
                            <li>
                                <div class="lvc-group">
                                    <ul class="lvc-group">
                                        <li data-id="{{ article.id }}" data-type="article" data-action="like"
                                            title="Нравится"><img src="{% static 'svg/up3+.svg' %}" alt="like"></li>
                                        <h5-2-lvc data-count="positive" class="positive">
                                            {% if article.rating.like.count %}
                                                {{ article.rating.like.count }}
                                            {% else %}
                                                {{ article.id|rating_positive }}
                                            {% endif %}
                                        </h5-2-lvc>
                                        <li data-id="{{ article.id }}" data-type="article" data-action="dislike"
                                            title="Не нравится"><img src="{% static 'svg/down3.svg' %}" alt="like"></li>
                                        <h5-2-lvc data-count="negative" class="negative">
                                            {% if article.rating.dislikes.count %}
                                                {{ article.rating.dislikes.count }}
                                            {% else %}
                                                {{ article.id|rating_negative }}
                                            {% endif %}
                                        </h5-2-lvc>
                                    </ul>
                                </div>
                            </li>
                            <li>
                                <div class="lvc-group">
                                    <ul class="lvc-group">
                                        <li><img src="{% static 'svg/carbon_view-filled_active.svg' %}" alt="view"></li>
                                        <li>
                                            <h5-2-lvc>{{ article.views }}</h5-2-lvc>
                                        </li>
                                    </ul>
                                </div>
                            </li>
                            <li>
                                <div class="lvc-group">
                                    <ul class="lvc-group show-comments">
                                        <li><img src="{% static 'svg/fluent_comment-24-filled_active.svg' %}"
                                                 alt="comm"></li>
                                        <li>
                                            <h5-2-lvc class="comments-counter">{{ article.pk|get_comments_count }}</h5-2-lvc>
                                        </li>
                                    </ul>
                                </div>
                            </li>
                        </ul>
                        <div class="comments-tree-block hidden"
                             data-article-id="{{ article.pk }}">
                            <div class="comments-tree-root"></div>
                            <form class="comment-form">
                                {% csrf_token %}
                                <textarea name="comment" class="comment-area"></textarea>
                                <button
                                        class="send-comment-button"
                                        type="button"
                                        data-article-id="{{ article.pk }}">
                                    Отправить
                                </button>
                            </form>
                        </div>

                    </div>
                {% endif %}


            </div>

            <div class="section-right">

                <div class="section-right-block">

                </div>

            </div>
        </div>
    </div>
{% endblock %}

{% block js %}
    <script type="text/javascript" src="{% static "js/mainapp/comment-form.js" %}"></script>
    <script type="text/javascript" src="{% static 'plugins/js/highlight.min.js' %}"></script>
    <script>
        $('.martor-preview pre').each(function (i, block) {
            console.log(hljs)
            hljs.highlightBlock(block);
        });
    </script>
{% endblock %}
